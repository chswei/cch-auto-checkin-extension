# 彰基自動打卡Chrome擴充功能

## 功能特色
- 🗓️ 雙日曆介面：分別選擇值班日（藍色）和請假日（紅色）
- 📋 自動排班預覽：根據醫院規則自動生成完整排班表
- 🤖 一鍵自動打卡：按順序自動填寫所有工作日的打卡記錄
- ⏰ 智慧班別判斷：自動識別平日、週六、值班的不同班別
- 🚫 智慧跳過邏輯：自動跳過值班隔日、請假日等不需打卡的日期

## 班別規則
- **平日上班**（週一-週五）：C02班別（08:00-17:30）
- **週六上班**：W02班別（08:00-12:00）  
- **平日值班**：DW2班別（08:00-隔日12:00）
- **週日值班**：DW6班別（08:00-隔日12:00）

## 安裝步驟

### 1. 載入擴充功能
1. 開啟 Chrome 瀏覽器
2. 導航到 `chrome://extensions/`
3. 開啟右上角的「開發者模式」
4. 點擊「載入未封裝項目」
5. 選擇 `auto-checkin-extension` 資料夾
6. 擴充功能將會出現在擴充功能列表中（會使用預設圖示）

## 使用方法

### 1. 登入彰基EIP系統
- 手動登入 https://dpt.cch.org.tw/EIP/
- 導航到打卡頁面：主選單 → 住院醫師 → 月結算作業

### 2. 使用擴充功能
1. 確保您在正確的打卡頁面上
2. 點擊 Chrome 工具列上的擴充功能圖示
3. 使用月份切換按鈕選擇要處理的月份
4. 在左側日曆選擇**值班日**（點擊會變藍色）
5. 在右側日曆選擇**請假日**（點擊會變紅色）
6. 查看下方的排班預覽表，確認排班正確
7. 點擊「開始自動打卡」按鈕
8. 等待系統自動處理完成

### 3. 注意事項
- ⚠️ 系統要求**按日期順序**填寫，不能跳過日期
- ⚠️ 執行前請確保當月沒有已填寫的記錄，或從第一個空白日期開始
- ⚠️ 建議先測試幾天，確認功能正常後再處理整個月
- ⚠️ 執行過程中請勿關閉瀏覽器或切換分頁

## 排班邏輯說明

### 自動跳過的情況
- **值班隔日**：值班日的隔天自動跳過
- **請假日**：手動選擇的請假日跳過
- **週日值班前週六**：如果週日值班，前一天週六跳過

### 班別自動判斷
- **一般平日**：週一到週五使用 C02班別
- **一般週六**：使用 W02班別  
- **平日值班**：使用 DW2班別（跨夜班）
- **週日值班**：使用 DW6班別（跨夜班）

## 技術架構
```
auto-checkin-extension/
├── manifest.json     # Chrome擴充功能設定檔
├── popup.html        # 彈出視窗使用者介面
├── popup.css         # 介面樣式
├── popup.js          # 介面邏輯和事件處理
├── utils.js          # 日期計算和排班規則工具
└── content.js        # 網頁DOM操作自動化腳本
```

## 最近更新 (2025-08-30)

### 🔧 修復的關鍵問題
- **CSS選擇器語法錯誤**: 修正了無效的 `:contains()` 選擇器語法錯誤
- **改善的按鈕查找**: 增強取消和送出按鈕的查找邏輯，提供更好的容錯性
- **增強的錯誤處理**: 增加詳細的錯誤訊息和調試資訊
- **重試機制**: 實作最多3次重試機制，提高成功率
- **動態月份識別**: 自動識別當前月份，不再硬編碼

### 🆕 新增功能
- **自動說明填寫**: 根據班別類型自動產生適當的說明文字
- **對話框驗證**: 改善對話框載入和關閉的驗證機制  
- **支援更多班別**: 新增 `DW2H`, `DW4`, `N` 等班別類型
- **改善的日誌系統**: 提供更詳細的操作記錄和錯誤追蹤

## 故障排除

### 已修復的問題 ✅
1. **SyntaxError: 'button:contains("取消")' is not a valid selector** - 已修復
2. **選擇器找不到元素** - 增強多重選擇策略
3. **對話框處理異常** - 改善驗證和清理機制

### 常見問題
1. **找不到編輯按鈕**
   - 確認您在正確的打卡頁面
   - 檢查頁面是否完全載入
   - 系統現已支援動態月份識別

2. **表單填寫失敗**
   - 系統現已有重試機制（最多3次）
   - 詳細錯誤訊息會顯示在控制台
   - 查看瀏覽器開發者工具的詳細錯誤日誌

3. **順序錯誤提示**
   - 確保從月初或第一個空白日期開始
   - 系統會自動跳過已填寫的記錄

### 開發者資訊
如需修改或調試，請查看：
- `utils.js` - 修改排班規則和日期邏輯
- `content.js` - 修改DOM選擇器和自動化腳本
- `popup.js` - 修改使用者介面行為

## 免責聲明
此工具僅用於簡化重複性作業，使用者應：
- 自行承擔使用風險
- 確認生成的排班表正確性
- 遵守醫院相關規定
- 建議先小範圍測試

---
**版本**: v1.0.0  
**適用**: 彰化基督教醫院EIP打卡系統  
**開發**: Claude Code 自動生成